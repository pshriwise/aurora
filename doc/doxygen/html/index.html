<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AURORA: AURORA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AURORA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AURORA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/aurora-multiphysics/aurora/actions/workflows/main.yml"><object type="image/svg+xml" data="https://github.com/aurora-multiphysics/aurora/actions/workflows/main.yml/badge.svg?event=push" style="pointer-events: none;">GitHub Actions build status</object></a> <a href="https://coveralls.io/github/aurora-multiphysics/aurora"><object type="image/svg+xml" data="https://coveralls.io/repos/github/aurora-multiphysics/aurora/badge.svg" style="pointer-events: none;">Coverage Status</object></a></p>
<p>The <a href="https://en.wikipedia.org/wiki/Aurora_(mythology)">name</a> of this application is based on the following acronym:</p>
<p><b>A</b> **U**nified **R**esource for **O**penMC (fusion) **R**eactor **A**pplications.</p>
<p>AURORA combines the Monte Carlo neutron transport calculations from OpenMC with the FEA calculations supported by the MOOSE framework, intended for the modelling of tokamak physics. Currently supported modules within MOOSE are Heat Conduction and Tensor Mechanics, intended to model the increase in temperature arising from heat deposited from neutrons, and subsequent thermal expansion and density changes respectively. Support for further modules is ongoing.</p>
<p>For more information on MOOSE see: [<a href="http://mooseframework.org">http://mooseframework.org</a>]</p>
<p>For more information on OpenMC see: [<a href="https://docs.openmc.org/en/stable/">https://docs.openmc.org/en/stable/</a>]</p>
<h1><a class="anchor" id="autotoc_md0"></a>
License</h1>
<p><a href="https://github.com/aurora-multiphysics/aurora">AURORA</a> is licensed under LGPL v2.1, see <a href="https://github.com/aurora-multiphysics/aurora/blob/main/LICENSE">here</a>.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<p>We currently provide support for Debian and Redhat flavours of Linux; we have explicitly tested for Ubuntu 20.04 and Fedora 33 using gcc 9.3.0.</p>
<p>If you would like support provided for another operating system or you experience any problems please get in touch via <a href="https://github.com/aurora-multiphysics/aurora/issues">GitHub Issues</a>, detailing your operating system using <code>lsb_release -a</code> (or equivalent), compiler version, and any relevant compiler errors.</p>
<p>If you do not want to build from source, please see the section on docker containers for a pre-built version.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Installation from Source</h2>
<p>First ensure you have all the dependencies installed, as outlined below. If you would like to install from source in a pre-built environment (i.e. you don't want to install the dependencies below), you may want to use one of our docker images (see section below).</p>
<h3><a class="anchor" id="autotoc_md3"></a>
A. Dependencies</h3>
<p>1) Parallel dependencies (optional) If you intend to run in parallel using either MPI or thread (or both) please ensure you have the following installed. a. MPI: OpenMPI / MPICH b. Threaded: OpenMP</p>
<p>2) OpenMC dependencies</p>
<ul>
<li>a. HDF5</li>
</ul>
<p>On Debian: </p><div class="fragment"><div class="line">apt-get install -y libhdf5-dev</div>
</div><!-- fragment --><p>or Redhat </p><div class="fragment"><div class="line">dnf -y install hdf5-devel</div>
</div><!-- fragment --><ul>
<li>b. <a href="https://bitbucket.org/fathomteam/moab">MOAB</a>. <div class="fragment"><div class="line">git clone https://bitbucket.org/fathomteam/moab &amp;&amp; \</div>
<div class="line">    cd moab &amp;&amp; \</div>
<div class="line">    git checkout Version5.2.0 &amp;&amp; \</div>
<div class="line">    autoreconf -fi &amp;&amp; \</div>
<div class="line">    mkdir bld &amp;&amp; \</div>
<div class="line">    cd bld &amp;&amp; \</div>
<div class="line">    ../configure --prefix=/home/moab \</div>
<div class="line">                --with-hdf5=/PATH-TO-libhdf5.so/ \</div>
<div class="line">                --enable-optimize \</div>
<div class="line">                --enable-shared \</div>
<div class="line">                --disable-debug &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    make check &amp;&amp; \</div>
<div class="line">    make install</div>
</div><!-- fragment --></li>
<li>c. <a href="https://github.com/pshriwise/double-down">(Optionally) Double Down</a> - if you want to leverage Intel Embree's ray tracing kernels within DAGMC. First install <a href="https://github.com/embree/embree">Embree</a> and its dependencies. <div class="fragment"><div class="line"># Embree dependencies</div>
<div class="line">sudo apt-get -y install libglfw3-dev libtbb-dev pkg-config</div>
<div class="line"> </div>
<div class="line"># Build Embree</div>
<div class="line">git clone https://github.com/embree/embree.git &amp;&amp; \</div>
<div class="line">    cd embree &amp;&amp; \</div>
<div class="line">    git checkout v3.6.1 &amp;&amp; \</div>
<div class="line">    mkdir build &amp;&amp; \</div>
<div class="line">    cd build &amp;&amp; \</div>
<div class="line">    cmake ../ \</div>
<div class="line">    -DCMAKE_CXX_COMPILER=$CXX \</div>
<div class="line">    -DCMAKE_C_COMPILER=$CC \</div>
<div class="line">    -DEMBREE_ISPC_SUPPORT=0 &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    make install </div>
<div class="line"> </div>
<div class="line"># Build DoubleDown</div>
<div class="line">    git clone https://github.com/pshriwise/double-down &amp;&amp; \</div>
<div class="line">    cd double-down &amp;&amp; \</div>
<div class="line">    mkdir build &amp;&amp; \</div>
<div class="line">    cd build &amp;&amp; \</div>
<div class="line">    cmake ../ \</div>
<div class="line">    -DMOAB_DIR=/home/moab \</div>
<div class="line">    -DEMBREE_DIR=/PATH-TO-EMBREE/ \</div>
<div class="line">    -DCMAKE_INSTALL_PREFIX=/INSTALL-PATH/ &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    make install</div>
</div><!-- fragment --></li>
<li>d. <a href="https://svalinn.github.io/DAGMC/install/index.html">DAGMC</a> Ensure to configure with Double Down if you want this library to be used. <div class="fragment"><div class="line">mkdir dagmc-bld &amp;&amp; \</div>
<div class="line">    git clone https://github.com/svalinn/DAGMC &amp;&amp; \</div>
<div class="line">    cd DAGMC &amp;&amp; \</div>
<div class="line">    git checkout develop &amp;&amp; \</div>
<div class="line">    cd ../ &amp;&amp; \</div>
<div class="line">    mkdir build &amp;&amp; \</div>
<div class="line">    cd build &amp;&amp; \</div>
<div class="line">    cmake ../DAGMC \</div>
<div class="line">    -DMOAB_DIR=/PATH-TO-MOAB/ \</div>
<div class="line">    -DDOUBLE_DOWN=on \</div>
<div class="line">    -DDOUBLE_DOWN_DIR=/PATH-TO-DOUBLE-DOWN/ \</div>
<div class="line">    -DBUILD_TALLY=ON \</div>
<div class="line">    -DCMAKE_INSTALL_PREFIX=/INSTALL-PATH/ &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    make test &amp;&amp; \</div>
<div class="line">    make install</div>
</div><!-- fragment --></li>
</ul>
<p>3) <a href="https://docs.openmc.org/en/stable/">OpenMC</a> </p><div class="fragment"><div class="line">mkdir openmc-bld &amp;&amp; \</div>
<div class="line">cd openmc-bld &amp;&amp; \</div>
<div class="line">git clone https://github.com/openmc-dev/openmc.git &amp;&amp; \</div>
<div class="line">cd openmc &amp;&amp; \</div>
<div class="line">git checkout develop &amp;&amp; \</div>
<div class="line">cd ../ &amp;&amp; \</div>
<div class="line">mkdir build &amp;&amp; \</div>
<div class="line">cd build &amp;&amp; \</div>
<div class="line">cmake ../openmc \</div>
<div class="line">      -Doptimize=on \</div>
<div class="line">      -Ddagmc=on \</div>
<div class="line">      -DCMAKE_INSTALL_PREFIX=/INSTALL-PATH/ \</div>
<div class="line">      -DDAGMC_DIR=/PATH-TO-DAGMC/ &amp;&amp; \</div>
<div class="line">make -j $compile_cores &amp;&amp; \</div>
<div class="line">make -j $compile_cores install</div>
</div><!-- fragment --><p>Further detailed installation instructions for OpenMC can be found <a href="https://docs.openmc.org/en/stable/usersguide/install.html">here</a>. Please ensure you configure with support for DagMC enabled, and support for MPI/threads enabled if you intend to run in parallel.</p>
<p>4) MOOSE ( + PETSc / libMesh ) Please follow these <a href="https://mooseframework.inl.gov/getting_started/installation/install_moose.html">installation instructions</a>.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
B. Environment</h3>
<p>The Makefile for AURORA assumes the following environment variables have been set:</p><ul>
<li><code>PETSC_DIR</code>: path to PETSc installation directory.</li>
<li><code>MOOSE_DIR</code>: path to MOOSE installation directory. Optionally you may want to set <code>MOOSE_JOBS</code> to the number of cores on your system.</li>
</ul>
<p>In addition it is expected that the following MOAB / DAGMC / OpenMC executables can be found in your PATH: <code>openmc</code> ; <code>mbconvert</code>; <code>make_watertight</code>.</p>
<p>Finally, in order to run AURORA, you will need to have set the variable <code>OPENMC_CROSS_SECTIONS</code> to point to a cross_sections.xml file, see <a href="https://docs.openmc.org/en/stable/usersguide/cross_sections.html#environment-variable">here</a> for more details.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
C. Build</h3>
<p>In case you skipped to this section, ensure you have set up your dependencies and environment as per sections A,B (or you are working in a pre-built docker container for these, see below). </p><div class="fragment"><div class="line">git clone https://github.com/aurora-multiphysics/aurora.git &amp;&amp; \</div>
<div class="line">    cd aurora/openmc/ &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    cd unit &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    cd ../../ &amp;&amp; \</div>
<div class="line">    make -j $compile_cores &amp;&amp; \</div>
<div class="line">    cd unit &amp;&amp; \</div>
<div class="line">    make -j $compile_cores</div>
</div><!-- fragment --><p>There should now be an executable <code>aurora-opt</code> in the root aurora directory.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
D. Run Tests</h3>
<p>To check your installation works, it's a good idea to run the test suite. Before you do this ensure the <code>OPENMC_CROSS_SECTIONS</code> environment variable points at a cross section file which contains KERMA-processed cross sections. For convenience we package a minimal set of cross sections needed for the tests, but you'll need to unpack them and set the <code>OPENMC_CROSS_SECTIONS</code> variable: </p><div class="fragment"><div class="line">cd aurora/data &amp;&amp; \</div>
<div class="line">   tar xzvf endfb71_hdf5.tgz &amp;&amp; \</div>
<div class="line">   export OPENMC_CROSS_SECTIONS=/PATH-TO-AURORA/aurora/data/endfb71_hdf5/cross_sections.xml </div>
</div><!-- fragment --><p>See <a href="https://openmc.discourse.group/t/nuclear-data-dependent-zero-result-for-heating-local-tally/833">this discussion</a> for further details. Now you can run the tests as follows </p><div class="fragment"><div class="line">cd aurora &amp;&amp; \</div>
<div class="line">./run_unit_tests</div>
</div><!-- fragment --><p>All the tests should pass. (Let us know via <a href="https://github.com/aurora-multiphysics/aurora/issues">GitHub Issues</a> if you experience problems.)</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Docker</h2>
<p>We appreciate that not all users will want to install the extensive list of dependencies upon which AURORA depends. Such users can simply download pre-built docker containers. For those who prefer Ubunutu: </p><div class="fragment"><div class="line">docker pull helenbrooks/aurora-ubuntu</div>
</div><!-- fragment --><p>...or for those who prefer Fedora: </p><div class="fragment"><div class="line">docker pull helenbrooks/aurora-fedora</div>
</div><!-- fragment --><p>Then just <code>docker run</code> the image you pulled and you're good to go. (For those users not experienced with docker, take a look at this <a href="https://docs.docker.com/get-started/">tutorial</a>.)</p>
<p>Alternatively you may want to install AURORA from source, but with pre-built dependencies. (e.g. perhaps you want to implement a new feature). In this case the relevant images are: </p><div class="fragment"><div class="line">docker pull helenbrooks/aurora-deps-ubuntu</div>
</div><!-- fragment --><p>for Ubuntu users, or </p><div class="fragment"><div class="line">docker pull helenbrooks/aurora-deps-fedora</div>
</div><!-- fragment --><p>for Fedora users. Spin up the image, and then follow the installation instructions from section C onwards.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage / Examples</h1>
<p>We recommend that you familiarise yourself with both OpenMC and MOOSE before trying AURORA, since AURORA (currently) depends on having input for both. Both OpenMC and MOOSE provide a number of examples <a href="https://docs.openmc.org/en/stable/examples/index.html">here</a> and <a href="https://mooseframework.inl.gov/getting_started/examples_and_tutorials/index.html">here</a>.</p>
<p>Specifically, OpenMC requires that the following files exist in your run directory:</p><ul>
<li><code>settings.xml</code></li>
<li><code>materials.xml</code></li>
<li><code>tallies.xml</code></li>
<li><code>dagmc.h5m</code></li>
</ul>
<p>The <code>dagmc.h5m</code> file is a surface mesh file, in length units assumed to be cm. This <a href="https://svalinn.github.io/DAGMC/usersguide/trelis_workflow.html">guide</a> provides details on the workflow to create such a file.</p>
<p>The AURORA application itself requires two input files, and an exodus file. For details on the syntax of these input files, see the following section.</p>
<p>The first input file controls the main driver application (which performs the FEA), and the second input file (referenced by the first) controls the sub-app that calls OpenMC. We recommend you have read <a href="https://mooseframework.inl.gov/syntax/MultiApps/index.html">this guide</a> on multiapps before proceeding.</p>
<p>Finally, the exodus file should contain a tetrahedral mesh of the geometry of interest. Currently this geometry needs to be the same as that in the dagmc.h5m file, however in future we intend to support the case where the FEA geometry is a subset of the OpenMC geometry. It is possible to use different lengthscales between the exodus and dagmc files, in which case the parameter <code>length_scale</code> for the <code><a class="el" href="classMoabUserObject.html" title="UserObject class which wraps a moab::Interface pointer.">MoabUserObject</a></code> should be set (e.g. to convert from m in the exodus file into cm in dagmc.h5m this parameter would be 100). Note that although MOOSE generically is unit-agnostic, it is necessary to have consistency with physical material properties. Thus, if you use m in your exodus file, ensure all length-dimensionful material properties are also given values in units of m.</p>
<p>There are two examples provided in the root aurora directory. The first example performs a simple neutronics + heat conduction simulation. </p><div class="fragment"><div class="line">./aurora-opt -i main.i</div>
</div><!-- fragment --><p>The second example performs neutronics + heat conduction + thermal expansion. </p><div class="fragment"><div class="line">./aurora-opt -i main_temp_mech.i</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Input File Syntax</h1>
<p>Please follow <a href="https://aurora-multiphysics.github.io/aurora/doc/htmldoc/index.html">this link</a> to see documentation for input file syntax.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
API Documentation</h1>
<p>Please follow <a href="https://aurora-multiphysics.github.io/aurora/doc/doxygen/html">this link</a> to find code documentation for developers.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Bugs / Problems / Feature Requests / Contact</h1>
<p>If you experience any problems with the code, or find a bug, or would like a new feature implemented, please raise an issue on <a href="https://github.com/aurora-multiphysics/aurora/issues">GitHub</a>. If you think you know how to fix said issue and would like to do it yourself, please see the guidelines in the next section.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Want to contribute?</h1>
<p>If you would like to contribute to the code, please adhere to the following process.</p>
<p>1) <a href="https://github.com/aurora-multiphysics/aurora/issues">Open an issue</a> on GitHub, detailing the change you would like to make. (This avoids multiple developers working on the same problem, and highlights your needs to us.)</p>
<p>2) Create a fork of the repository and clone onto your machine, see <a href="https://docs.github.com/en/enterprise/2.13/user/articles/fork-a-repo#:~:text=A%20fork%20is%20a%20copy,point%20for%20your%20own%20idea">here</a>.</p>
<p>3) Create a branch in the local copy of your fork. </p><div class="fragment"><div class="line">git checkout -b &lt;my_branch_name&gt;</div>
</div><!-- fragment --><p>4) Make your changes, commit and push to your fork on GitHub. </p><div class="fragment"><div class="line">git add &lt; modified files&gt;</div>
<div class="line">git commit -m &#39;Here is a concise statement of changes&#39;</div>
<div class="line">git push</div>
</div><!-- fragment --><p>(If the changeset is large this is best split over several commits, one commit for each notable feature change).</p>
<p>5) Ensure that all tests pass. (See Run Tests section above.) If you have implemented a new feature, please ensure there is at least one unit test probing each public method of any new classes. It is good practice to ensure that pre-existing tests pass for each commit (unless noted otherwise in commit message).</p>
<p>6) Make sure your branch is up-to-date with any changes in the main branch of the aurora-multiphysics/aurora repository so that merging your changes is a smooth process. It is easy to stay in sync as follows:</p><ul>
<li>Configure a remote. <div class="fragment"><div class="line">git remote add upstream https://github.com/aurora-multiphysics/aurora.git</div>
</div><!-- fragment --></li>
</ul>
<p>(Check this worked with <code>git remote -v</code>.)</p><ul>
<li>Fetch upstream changes into your local fork: <div class="fragment"><div class="line">git fetch upstream</div>
</div><!-- fragment --></li>
<li>Switch to <code>main</code> branch (either <code>git stash</code> or commit your local changes first). <div class="fragment"><div class="line">git switch main</div>
</div><!-- fragment --></li>
<li>Merge the changes into your fork repository's <code>main</code> branch. <div class="fragment"><div class="line">git merge upstream/main</div>
</div><!-- fragment --></li>
<li>Switch back to your development branch. <div class="fragment"><div class="line">git switch &lt;my_branch_name&gt;</div>
</div><!-- fragment --></li>
<li>Finally, roll your changes on top of the changes from <code>main</code>. <div class="fragment"><div class="line">git rebase main</div>
</div><!-- fragment --></li>
</ul>
<p>For a nice explanation of rebasing, see <a href="https://git-scm.com/book/en/v2/Git-Branching-Rebasing">here</a>. It's possible you may at this point have to deal with conflicts; manually edit the files which are in conflict to resolve them, then run: </p><div class="fragment"><div class="line">git rebase --continue</div>
</div><!-- fragment --><p>It is a good idea to sync frequently so that your branch does not deviate significantly or merging will become quite a headache! Note, we will not approve pull requests that are not up-to-date with our <code>main</code> branch.</p>
<p>7) Update documentation (currently manual):</p><ul>
<li>Generate/update MOOSE markdown stubs <div class="fragment"><div class="line">cd doc &amp;&amp; ./moosedocs.py generate app_types OpenMCApp AuroraApp</div>
</div><!-- fragment --></li>
<li>Build the MOOSE html pages <div class="fragment"><div class="line">cd doc &amp;&amp; ./moosedocs.py build --destination=htmldoc</div>
</div><!-- fragment --></li>
<li>Build the doxgyen html pages <div class="fragment"><div class="line">doxygen doc/doxygen/Doxyfile</div>
</div><!-- fragment --></li>
<li>Commit changes.</li>
</ul>
<p>8) Create a pull request, detailing the changes you have made and reference your original issue. Creating a pull request will trigger our CI pipeline, which tests the build and runs tests in two environments. If you would like to test your changes in a different environment to your own, you may want to use our docker images (see section on docker above).</p>
<p>Once a pull request has been opened we will review your code. We may require some changes, in which case you'll need to make some further commits. Once your code has been reviewd and approved, we will merge it into <code>main</code>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
